# FinSight - æœ€ç»ˆç‰ˆæ¶æ„å›¾

æ­¤å›¾è¡¨å±•ç¤ºäº† `finsight-app` (å‰ç«¯+BFF) ä¸ `finsight-backend` (AI+æ•°æ®) ä¸¤ä¸ªç‹¬ç«‹å¾®æœåŠ¡ä¹‹é—´çš„ååŒå·¥ä½œæµç¨‹ã€‚

```mermaid
graph TD
    %% 1. å®šä¹‰ç”¨æˆ·å’Œå¤–éƒ¨API
    User(ğŸ‘¤ ç”¨æˆ·)
    LLM_API[LLM API (GLM)]
    Tushare_API[Tushare API]

    %% 2. å®šä¹‰ `finsight-app` (Next.js)
    subgraph finsight-app (Next.js åº”ç”¨ - å®‰å…¨ç½‘å…³/BFF)
        direction TB
        Frontend[React å‰ç«¯ UI (åœ¨æµè§ˆå™¨ä¸­)]
        BFF[Next.js API è·¯ç”± (BFF - /api/analyze)]
        
        Frontend -- 1. ç”¨æˆ·æŸ¥è¯¢ --> BFF
    end

    %% 3. å®šä¹‰ `finsight-backend` (Python)
    subgraph finsight-backend (Python AI åç«¯æœåŠ¡)
        direction TB
        
        %% 3a. åœ¨çº¿åˆ†ææœåŠ¡ (CrewAI)
        subgraph Online_App [åœ¨çº¿åˆ†ææœåŠ¡ (/app - FastAPI)]
            CrewAI[CrewAI æ€»è°ƒåº¦å™¨]
            Agent1[Agent 1: éœ€æ±‚è§£æ]
            Agent2[Agent 2: æ•°æ®æ£€ç´¢]
            Agent3[Agent 3: ç»¼åˆåˆ†æ]
            
            CrewAI --> Agent1
            CrewAI --> Agent2
            CrewAI --> Agent3
        end

        %% 3b. ç¦»çº¿æ•°æ®ç®¡é“
        subgraph Offline_Collection [ç¦»çº¿æ•°æ®ç®¡é“ (/collection)]
            Collection[ğŸ Python é‡‡é›†è„šæœ¬ (å®šæ—¶è¿è¡Œ)]
        end
    end

    %% 4. å®šä¹‰æ•°æ®å­˜å‚¨ (äº‘æœåŠ¡)
    subgraph Data_Stores [æ•°æ®å­˜å‚¨ (äº‘æœåŠ¡)]
        Supabase[(Supabase / PostgreSQL)]
        Qdrant[(Qdrant Cloud / å‘é‡æ•°æ®åº“)]
    end

    %% 5. å»ºç«‹æ‰€æœ‰è¿æ¥

    %% --- åœ¨çº¿åˆ†ææµç¨‹ (Online Flow) ---
    BFF -- 2. [å®‰å…¨è½¬å‘] HTTPè¯·æ±‚ (user_query) --> CrewAI

    Agent1 -- 3. [æ„å›¾åˆ†æ] è°ƒç”¨ --> LLM_API
    
    Agent2 -- 4. [æ•°æ®æ£€ç´¢] è°ƒç”¨å·¥å…· --> Supabase
    Agent2 -- 5. [RAGæ£€ç´¢] è°ƒç”¨å·¥å…· --> Qdrant
    Agent2 -- 6. [å®æ—¶æ•°æ®] è°ƒç”¨å·¥å…· --> Tushare_API
    
    Agent3 -- 7. [ç»¼åˆåˆ†æ] è°ƒç”¨ --> LLM_API
    
    CrewAI -- 8. [è¿”å›æœ€ç»ˆæŠ¥å‘ŠJSON] --> BFF
    BFF -- 9. [è¿”å›ç»™å‰ç«¯] --> Frontend

    %% --- ç¦»çº¿æ•°æ®æµç¨‹ (Offline Flow) ---
    Collection -- a. (æ‰¹é‡)è°ƒç”¨ --> Tushare_API
    Collection -- b. (UPSERT)å†™å…¥ç»“æ„åŒ–æ•°æ® --> Supabase
    Collection -- c. (æ‰¹é‡)å†™å…¥å‘é‡æ•°æ® --> Qdrant